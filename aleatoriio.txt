<?php

$pila = array();
$ruta="G:\imagenes/";
$i = 0;
$auxArchivo="";
$directorio = opendir($ruta); //ruta actual
while ($archivo = readdir($directorio)) //obtenemos un archivo y luego otro sucesivamente
{
    if (is_dir($archivo))//verificamos si es o no un directorio
    {
      //  echo "[".$archivo . "]<br />"; //de ser un directorio lo envolvemos entre corchetes
    }
    else
    {
        $auxArchivo=$archivo;
        array_push($pila, $archivo);
            $directorio1 = opendir($ruta.$archivo);
             while ($archivo = readdir($directorio1 )) //obtenemos un archivo y luego otro sucesivamente
             {
               if (is_dir($archivo))//verificamos si es o no un directorio
               {
                // echo "[".$archivo . "]<br />"; //de ser un directorio lo envolvemos entre corchetes
              }
              else
              {
                  array_push($pila, $archivo);
              }
        }
        $fic[$i] = array( $auxArchivo =>$pila[array_rand($pila)]);
        print_r($fic[$i]);
        echo "</br>";
        $i++;
        $pila = array();
    }
}
echo "</br>";
print_r(json_encode($fic)); 