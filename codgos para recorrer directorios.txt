<?php
header('Content-Type: application/json'); 
$ruta="G:/ejemplo";
//Variable para almacenar nombres de las carpetas
//Variable to store folder names
$nombreCarpeta="vacio";
//Contador del arreglo
//Array counter
$i = 0;
//varibale almacenar los arreglos
//varibale stored array
$fic;

function unArchivoAleatorioDeCadaCarpeta($ruta,$nombreCarpeta){
    $GLOBALS["pila"] = array();
    //ruta actual
    // current path
    $directorio = opendir($ruta); 
    //obtenemos un archivo y luego otro sucesivamente
    //we get a file and then another one successively
    while ($archivo = readdir($directorio)) 
    {
        //verificamos si es o no un directorio
        // check whether or not it is a directory
        if (is_dir($ruta."/".$archivo))
        {
            if ($archivo != "." && $archivo != "..") {
                //Es un directorio, buscamos archivos dentro del mismo
                // It is a directory, we look for files within it
                unArchivoAleatorioDeCadaCarpeta($ruta."/".$archivo,$archivo);
            }
        }else{
            //almacena el nombre de los archivos en un array temporalmente
            // store the name of the files in an array temporarily
            array_push($GLOBALS["pila"], $archivo);
        }
        
    }
    //escojemos un archivo al azar con el nombre de su respectiva carpeta
    // let's choose a file at random with the name of its respective folder
    $GLOBALS["fic"][$GLOBALS["i"]] = array($nombreCarpeta=> $GLOBALS["pila"] [array_rand($GLOBALS["pila"])]);
    //borramos el directorio "vacio" ya que no nos sirve
    // delete the "empty" directory since it does not work for us
    $search_array=$GLOBALS["fic"][$GLOBALS["i"]];
    if(array_key_exists('vacio',$search_array)){
        unset($GLOBALS["fic"][$GLOBALS["i"]]);
    }
    else{
        //seguimos con el siguiente directorio
        // we continue with the following directory
        $GLOBALS["i"]++;
    }
}
//Llamamos a la funcion e imprimimos el JSON
// We call the function and print the JSON
unArchivoAleatorioDeCadaCarpeta($ruta,$nombreCarpeta);
print_r(json_encode($fic,JSON_PRETTY_PRINT)); 



/*
function obtener_estructura_directorios($ruta){
    // Se comprueba que realmente sea la ruta de un directorio
    $pila = array();
    $valor=1;
    if (is_dir($ruta)){
        // Abre un gestor de directorios para la ruta indicada
        $gestor = opendir($ruta);
        // Recorre todos los elementos del directorio
        while (($archivo = readdir($gestor)) !== false)  {
                
            $ruta_completa = $ruta . "/" . $archivo;

            // Se muestran todos los archivos y carpetas excepto "." y ".."
            if ($archivo != "." && $archivo != "..") {
                // Si es un directorio se recorre recursivamente
                if (is_dir($ruta_completa)) {
                    echo "</br>";
                    echo "</br>";
                    echo "" . $archivo . "";
                    echo "</br>";
                    echo "</br>";
                    obtener_estructura_directorios($ruta_completa);
                    $valor=1;
                } elseif($valor==1) {
                   // echo "<li>" . $archivo . "</li>";
                 // $valor=0;
                    //array_push($pila, $archivo);
                    echo "" . $archivo . "";
                    echo "</br>";
                }
                
            }
            
        }
     //   echo  $pila[array_rand($pila)];
        // Cierra el gestor de directorios
        closedir($gestor);
        echo "</ul>";
        //print_r($pila);
        //var_export ($pila);
       

    } else {
        echo "No es una ruta de directorio valida<br/>";
    }
  
}

//obtener_estructura_directorios($ruta);





$parent_dir="G:/ejemplo";
//print_r();
read_dir_content($parent_dir, 0);

$i = 0;
$auxArchivo="";
$auxSubCarpeta=0;
function read_dir_content($parent_dir, $depth = 0){
    echo "Entro a la funcion";
    echo "</br>";
    $auxSubCarpeta=$depth;
    $str_result = "";
   // $str_result .= "<li> dirname ". dirname($parent_dir) ."</li>";
    //$str_result .= "<ul>";
    if(is_dir($parent_dir)){
        if ($handle = opendir($parent_dir)) 
        {
            while (false !== ($file = readdir($handle)))
            {
                echo "Entro al while ".$file;
                echo "</br>";
                //if(in_array($file, array('.', '..'))) continue;
                //$str_result .= "<li>{$file}</li>";

                    if( is_dir($parent_dir . "/" . $file) ){
                    echo "Entro al if";
                    echo "</br>";
                    if(!$auxSubCarpeta==$depth){
                        echo "Nombre Carpeta ----- ".  $file. " ".$depth;
                    }else{
                        echo "Sub Carpeta----- ".  $file. " ".$depth;
                    }
                    echo "</br>";
                    $str_result .= "<li>" . read_dir_content($parent_dir . "/" . $file, $depth++) . "</li>";
                }
                else{
                    echo "Entro al else";
                    echo "</br>";
                    $d=explode("/",$parent_dir);
                    $a=end($d);
                    print_r( $a );
                    echo "-------- Archivos ".$file;
                    echo "</br>";
                }
            }
            closedir($handle);
        
        }
        $str_result .= "</ul>";
    }

    
   // return $str_result;
}
*/